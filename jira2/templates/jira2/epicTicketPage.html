{% extends "jira2/baseTicket.html" %}
{% load static %}
{% block ticketContent %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/css/bootstrap-select.min.css">
<div class="card">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="#">Projects</a></li>
            <li class="breadcrumb-item"><a href="#">{{ticket.project}}</a></li>
           	<li class="breadcrumb-item">
                <img src='{% static ticket.issueType.icon %}' width="20" height="20" data-toggle="tooltip" data-placement="top" title="{{ticket.issueType.code}}">
                &nbsp;
                <a href="#">{{ticket.internalKey}}</a>
            </li>
        </ol>
    </nav>
    <input class="form-control" type="text" id="ticket-summary" value="{{ticket.summary}}" style="border: 0; font-size:22px;"/>

    <div class="card-body tab-content">
    	<button type="button" class="btn btn-light" onclick="initaliseTicket();">Create Tickets</button>
    </div>

    <div class="card-body tab-content">
        <p class="font-weight-bold">Description</p>
        <div class="form-group">
            <textarea class="form-control" name="ticket-description" rows="1" style="border: 0;" onfocusout="updateTicketDescription();">{{ticket.description}}</textarea>
        </div>
        <!--  -->
        <p class="font-weight-bold">User Impact</p>
        <div class="form-group">
            <textarea class="form-control" name="ticket-user-impact" rows="1" style="border: 0;" onfocusout="updateUserImpact();">{{ticket.userImpact}}</textarea>
        </div>
        <!--  -->
        <p class="font-weight-bold">Release Impact</p>
        <div class="form-group">
            <textarea class="form-control" name="ticket-release-impact" rows="1" style="border: 0;" onfocusout="updateReleaseImpact();">{{ticket.releaseImpact}}</textarea>
        </div>
        <!--  -->
        <p class="font-weight-bold">Automatic Testing Reason</p>
        <div class="form-group">
            <textarea class="form-control" name="ticket-automatic-testing-reason" rows="1" style="border: 0;" onfocusout="updateAutomaticTestingReason();">{{ticket.automatedTestingReason}}</textarea>
        </div>

        <!--  -->

        <div id="tickets-container">
            <div class="row">
                <div class="col">
                    <p class="font-weight-bold">Issues in the epic</p>
                </div>
                <div class="col-auto">
                    <i class="fa fa-plus-square-o" style="font-size:24px;cursor: pointer;" onclick="initaliseTicket();"></i>
                </div>
            </div>
            <div id="epic-tickets-container">
                {% for et in ticket.epicTickets.all %}
                    <div class="card" id="epic-ticket-container-{{et.id}}">
                        <div class="card-body" style="height: 10px;">
                            <div class="row">
                                <div class="col-auto" style="margin-top: -13px; margin-left: -10px;">
                                    <img src='{% static et.issueType.icon %}' width="20" height="20" data-toggle="tooltip" data-placement="top" title="{{et.issueType.internalKey}}">
                                </div>
                                <div class="col-auto" style="margin-top: -12px; margin-left: -15px;">
                                    <a href="#">{{et.internalKey}}</a>
                                </div>
                                <div class="col" style="margin-top: -12px; margin-left: -15px;">
                                    <span>{{et.summary}}</span>
                                </div>
                                <div class="col-auto" style="margin-top: -12px; margin-left: -15px;">
                                    <span class="{{et.priority.icon}}">{{et.priority}}</span>
                                </div>
                                <div class="col-auto" style="margin-top: -18px; margin-left: -15px;">
                                    {% if et.assignee %}
                                    <img class="avatar filter-by-alt" src="{{ et.assignee.developerProfile.profilePicture.url }}" data-filter-by="alt" data-toggle="tooltip" data-placement="top" title="{{et.assignee.get_full_name}}">
                                    {% else %}
                                    <img class="avatar filter-by-alt" src="https://cdn3.iconfinder.com/data/icons/avatars-round-flat/33/man5-512.png" data-filter-by="alt">
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                {% endfor %}
                <div class="row">
                	<div class="col-4">
                		<select id="mySelect" data-show-content="true" class="form-control">
			                <option>Select..</option>
			                {% for ji in jiraIssues.all %}
				                {% if ji.code == "STORY" %}
				                <option data-content="<img src='{% static ji.icon %}' width='20' height='20'> {{ji}}" selected="selected"></option>
				                {% else %}
				                <option data-content="<img src='{% static ji.icon %}' width='20' height='20'> {{ji}}"></option>

				                {% endif %}
			                {% endfor %}
			            </select>
                	</div>
                	<div class="col-8">
                		<input class="form-control" id="new-ticket-name" type="text" placeholder="What needs to be done?">
                	</div>
                </div>
            </div>
        </div>
        <br>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/js/bootstrap-select.min.js"></script>
<script type="text/javascript">
    function initaliseTicket()
    {
        if($('#new-ticket-name').length)
            return;

        $('#epic-tickets-container').append(`
        	<div id="epic-tickets-creator">
            	<input class="form-control" id="new-ticket-name" type="text" placeholder="What needs to be done?">
            	<br>
            	<button type="button" class="btn btn-primary pull-right" onclick="createTicket();">Create</button>
            	<button type="button" class="btn btn-light pull-right" onclick="cancelTicket();" style="margin-right: 15px;">Cancel</button>
            </div>
            `
        );
    }

    function cancelTicket()
    {
        $('#epic-tickets-creator').remove();
    }

    $('#mySelect').selectpicker();
</script>
{% endblock %}