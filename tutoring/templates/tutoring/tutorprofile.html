{% extends "accounts/account_base.html" %}
{% load static %}
{% block content %}
<style type="text/css">
	.profile-sidebar{padding:20px 0 10px 0;background:#fff}.profile-userpic img{float:none;margin:0 auto;width:50%;height:50%;-webkit-border-radius:50%!important;-moz-border-radius:50%!important;border-radius:50%!important}.profile-usertitle{text-align:center;margin-top:20px}.profile-usertitle-name{color:#5a7391;font-size:16px;font-weight:600;margin-bottom:7px}.profile-usertitle-job{text-transform:uppercase;color:#5b9bd1;font-size:12px;font-weight:600;margin-bottom:15px}.profile-userbuttons{text-align:center;margin-top:10px}.profile-userbuttons .btn{text-transform:uppercase;font-size:11px;font-weight:600;padding:6px 15px;margin-right:5px}.profile-userbuttons .btn:last-child{margin-right:0}.mtgtlDwEfX{font-size:12px;padding:3px 8px;border-radius:4px;text-align:center;color:#fff;background-color:#000;opacity:.64}
	@media (min-width: 1200px) {
		.container {
			width: 1600px;
		}
		.wrapper {
			width: 75%;
		}
	}

	@media (min-width: 972px) and (max-width: 1200px) {
		.container {
			width: 1600px;
		}
		.wrapper {
			width: 90%;
		}
	}

	@media (min-width: 700px) and (max-width: 959px) {
		.container {
			width: 1600px;
		}
		.wrapper {
			width: 90%;
		}
	}

	.total-like-user-main a{display:inline-block;margin:0 -17px 0 0}.total-like{border:1px solid;border-radius:50px;display:inline-block;font-weight:500;height:34px;line-height:33px;padding:0 13px;vertical-align:top}.restaurant-detailed-ratings-and-reviews hr{margin:0 -24px}.text-black{color:#000}.reviews-members .media .mr-3{width:56px;height:56px;object-fit:cover}.rounded-pill{border-radius:50rem!important}.total-like-user{border:2px solid #fff;height:34px;box-shadow:0 .125rem .25rem rgba(0,0,0,.075)!important;width:34px}.total-like-user-main a{display:inline-block;margin:0 -17px 0 0}.total-like{border:1px solid;border-radius:50px;display:inline-block;font-weight:500;height:34px;line-height:33px;padding:0 13px;vertical-align:top}.restaurant-detailed-ratings-and-reviews hr{margin:0 -24px}.graph-star-rating-header .star-rating{font-size:17px}.progress{background:#f2f4f8 none repeat scroll 0 0;border-radius:0;height:30px}.rating-list{display:inline-flex;margin-bottom:15px;width:100%}.rating-list-left{height:16px;line-height:29px;width:10%}.rating-list-center{width:80%}.rating-list-right{line-height:29px;text-align:right;width:10%}.text-black{color:#000}.graph-star-rating-header .star-rating{font-size:17px}.progress{background:#f2f4f8 none repeat scroll 0 0;border-radius:0;height:30px}.rating-list{display:inline-flex;margin-bottom:15px;width:100%}.rating-list-left{height:16px;line-height:29px;width:10%}.rating-list-center{width:80%}.rating-list-right{line-height:29px;text-align:right;width:10%}.progress{background:#f2f4f8 none repeat scroll 0 0;border-radius:0;height:30px}

</style>
<div class="profile-userbuttons">
	<div class="modal fade" id="questionModal" tabindex="-1" role="dialog" aria-labelledby="questionModalLabel" aria-hidden="true">
		<div class="modal-dialog" role="document">
			<div class="modal-content" style="color: black;">
				<div class="modal-header">
					<h3 class="modal-title" id="exampleModalLabel" style="display: inline-block;">Enter your Question below.</h3>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close" style="display: inline-block;">
					<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<div class="form-group">
						<label for="subject-related" class="col-form-label pull-left"><b>Select a subject</b></label>
						<select class="form-control" id="subject" name="subject">
							{% for subject in subjects %}
							<option value="{{subject.name}}">{{subject.name}}</option>
							{% endfor %}
						</select>
					</div>
					<div class="form-group">
						<label for="question" class="col-form-label pull-left"><b>Question:</b></label>
						<textarea class="form-control" id="question" name="question" required></textarea>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
						<button type="submit" class="btn btn-success" onclick="post_question();">Post my Question</button>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="modal fade" id="tutorReview" tabindex="-1" role="dialog" aria-labelledby="tutorReviewLabel" aria-hidden="true">
	<div class="modal-dialog" role="document">
		<div class="modal-content" style="color: black;">
			<div class="modal-header">
				<h3 class="modal-title" id="exampleModalLabel" style="display: inline-block;">Enter your review below.</h3>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close" style="display: inline-block;">
				<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<div class="form-group">
					<label for="rating_value-related" class="col-form-label pull-left"><b>Rating:</b></label>
					<select class="form-control" id="rating_value" name="rating_value">
						<option value="0">0</option>
						<option value="1">1</option>
						<option value="2">2</option>
						<option value="3">3</option>
						<option value="4">4</option>
						<option value="5">5</option>
					</select>
				</div>
				<div class="form-group">
					<label for="review_comment" class="col-form-label pull-left"><b>Comment:</b></label>
					<textarea class="form-control" id="review_comment" name="review_comment" rows="5" required></textarea>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
					<button type="submit" class="btn btn-success" onclick="post_review();">Post my review</button>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="wrapper" style="margin: auto;overflow-x: hidden;">
	<br>
	<div class="row gutters-sm">
		<div class="col-lg-3 d-md-block">
			<div class="card">
				<div class="card-body">
					<div class="d-flex flex-column align-items-center text-center">
						{% if tutorProfile.profilePicture %}
						<img src="{{ tutorProfile.profilePicture.url }}" class="rounded-circle" width="150" height="150" alt="Error" />
						{% else %}
						<img src="https://icon-library.com/images/default-user-icon/default-user-icon-13.jpg" class="rounded-circle" width="150" height="150" alt="Error" />
						{% endif %}
						<div class="mt-3">
							<h4 style="color: black;">{{ tutorProfile.user.first_name }} {{ tutorProfile.user.last_name }}</h4>
							<p class="text-secondary mb-1">{{ tutorProfile.summary }}</p>
							{% if user.pk != tutorProfile.user.pk %}
							<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#questionModal">Ask a Question</button>
							<button type="button" class="btn btn-outline-primary" onclick="StartMessage();">Message</button>
							{% endif %}
						</div>
					</div>
				</div>
			</div>
			<div class="card mt-3" style="color: black;">
				<ul class="list-group list-group-flush">
					<li class="list-group-item d-flex justify-content-between align-items-center flex-wrap">
						<h6 class="mb-0">
							<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-globe mr-2 icon-inline">
								<circle cx="12" cy="12" r="10"></circle>
								<line x1="2" y1="12" x2="22" y2="12"></line>
								<path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
							</svg>
							Website
						</h6>
						<span class="text-secondary">https://bootdey.com</span>
					</li>
					<li class="list-group-item d-flex justify-content-between align-items-center flex-wrap">
						<h6 class="mb-0">
							<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github mr-2 icon-inline">
								<path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
							</svg>
							Github
						</h6>
						<span class="text-secondary">bootdey</span>
					</li>
					<li class="list-group-item d-flex justify-content-between align-items-center flex-wrap">
						<h6 class="mb-0">
							<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-twitter mr-2 icon-inline text-info">
								<path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path>
							</svg>
							Twitter
						</h6>
						<span class="text-secondary">@bootdey</span>
					</li>
					<li class="list-group-item d-flex justify-content-between align-items-center flex-wrap">
						<h6 class="mb-0">
							<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-instagram mr-2 icon-inline text-danger">
								<rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect>
								<path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path>
								<line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line>
							</svg>
							Instagram
						</h6>
						<span class="text-secondary">bootdey</span>
					</li>
					<li class="list-group-item d-flex justify-content-between align-items-center flex-wrap">
						<h6 class="mb-0">
							<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-facebook mr-2 icon-inline text-primary">
								<path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path>
							</svg>
							Facebook
						</h6>
						<span class="text-secondary">bootdey</span>
					</li>
				</ul>
			</div>
			<br>
			<div class="card" style="color: black;">
				<nav class="nav flex-column nav-pills nav-gap-y-1">
					<a href="#tutor_profile" data-toggle="tab" class="nav-item nav-link has-icon nav-link-faded active">
					<i class='fa fa-user' style='font-size:20px'></i>
					&nbsp;&nbsp;
					<label class="side-bar-text">Profile</label>
					</a>
					<a href="#q_and_a" data-toggle="tab" class="nav-item nav-link has-icon nav-link-faded">
					<i class='fas fa-question' style='font-size:20px'></i>
					&nbsp;&nbsp;
					<label class="side-bar-text">Q and A</label>
					</a>
					<a href="#tutor_reviews" data-toggle="tab" class="nav-item nav-link has-icon nav-link-faded">
					<i class='fa fa-star' style='font-size:20px'></i>
					&nbsp;&nbsp;
					<label class="side-bar-text">Reviews</label>
					</a>
				</nav>
			</div>
		</div>
		<div class="col-lg-9">
			<div class="card">
				<div class="card-body tab-content" style="color: black;">
					<div class="tab-pane active" id="tutor_profile">
						<div>
							<h3>About</h3>
							<p>{{ tutorProfile.about|linebreaksbr }}</p>
						</div>
						<hr>
						<br>
						<div>
							<h3>Education</h3>
							<div>
								{% for key,value in tutorProfile.education.items %}
								<div style="display: flex; flex-direction: row; align-items: flex-start; justify-content: flex-start; margin-bottom: 15px;">
									<img src="https://www.iconfinder.com/data/icons/building-1/512/build2-512.png"
										style="width: 50px; height: 50px; margin-right: 13px; -o-object-fit: contain; object-fit: contain; border-radius: 4px;">
									<div style="flex: 1 1; flex-direction: column;">
										<b style="margin-bottom: 5px;">{{value.school_name}}</b>
										<p style="margin-bottom: 0;">{{value.qualification}} ({{value.year}})</p>
									</div>
								</div>
								{% endfor %}
							</div>
						</div>
						<hr>
						<br>
						<div>
							<div class="row">
								<div class="col-sm-6">
									<h3 for="availability">Availability</h3>
									<table class="table" id="availabilitySchedule" style="width: auto;">
										<thead>
											<tr>
												<th scope="col"></th>
												<th scope="col">Morning</th>
												<th scope="col">Afternoon</th>
												<th scope="col">Evening</th>
											</tr>
										</thead>
										<tbody>
											{% for key,value in tutorProfile.availability.items %}
											<tr>
												<th style="vertical-align: middle;" scope="row">{{key|title}}</th>
												<td style="text-align: center">
													{% if value.morning %}
													<div class="btn-group" data-toggle="buttons">
														<label class="btn btn-success" disabled> <i class="fas fa-check"></i>
														</label>
													</div>
													{% else %}
													<div class="btn-group" data-toggle="buttons">
														<label class="btn btn-danger" disabled> <i class="fas fa-times"></i>
														</label>
													</div>
													{% endif %}
												</td>
												<td style="text-align: center">
													{% if value.afternoon %}
													<div class="btn-group" data-toggle="buttons">
														<label class="btn btn-success" disabled> <i class="fas fa-check"></i>
														</label>
													</div>
													{% else %}
													<div class="btn-group" data-toggle="buttons">
														<label class="btn btn-danger" disabled> <i class="fas fa-times"></i>
														</label>
													</div>
													{% endif %}
												</td>
												<td style="text-align: center">
													{% if value.evening %}
													<div class="btn-group" data-toggle="buttons">
														<label class="btn btn-success" disabled> <i class="fas fa-check"></i>
														</label>
													</div>
													{% else %}
													<div class="btn-group" data-toggle="buttons">
														<label class="btn btn-danger" disabled> <i class="fas fa-times"></i>
														</label>
													</div>
													{% endif %}
												</td>
											</tr>
											{% endfor %}
										</tbody>
									</table>
								</div>
								<div class="col-sm-6">
									<h3>Subjects</h3>
									<div style="display: flex; flex-flow: row wrap;" id="list_of_subjects">
										<!-- {% for subject in tutorProfile.subjects %} <a href="" style="margin:
											0 10px 10px 0;">
											
											<dir class="mtgtlDwEfX">
											
											{{ subject }}
											
											</dir>
											
											</a>
											
											{% endfor %} -->
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="tab-pane" id="q_and_a">
						<div class="modal fade" id="answerModal" tabindex="-1" role="dialog" aria-labelledby="answerModalLabel" aria-hidden="true">
							<div class="modal-dialog" role="document">
								<div class="modal-content" style="color: black;">
									<div class="modal-header">
										<h3 class="modal-title" id="exampleModalLabel" style="display: inline-block;">Answer the Question below.</h3>
										<button type="button" class="close" data-dismiss="modal" aria-label="Close" style="display: inline-block;">
										<span aria-hidden="true">&times;</span>
										</button>
									</div>
									<div class="modal-body">
										<!-- <form method="post"> -->
										<!-- {% csrf_token %} -->
										<div class="form-group">
											<label for="question_text" class="col-form-label pull-left">Question</label>
											<textarea class="form-control" id="question_text" name="question_text" readonly></textarea>
										</div>
										<div class="form-group">
											<label for="answer_text" class="col-form-label pull-left">Answer</label>
											<textarea class="form-control" id="answer_text" name="answer_text" required></textarea>
										</div>
										<input type="text" name="question_id" id="question_id" hidden/>
										<div class="modal-footer">
											<button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
											<button type="submit" class="btn btn-success" onclick="post_answer();">Post my Answer</button>
										</div>
										<!-- </form> -->
									</div>
								</div>
							</div>
						</div>
						<!-- TOEDIT -->
						<div class="modal fade" id="editQuestionModal" tabindex="-1" role="dialog" aria-labelledby="editQuestionModalLabel" aria-hidden="true">
							<div class="modal-dialog" role="document">
								<div class="modal-content" style="color: black;">
									<div class="modal-header">
										<h3 class="modal-title" id="exampleModalLabel" style="display: inline-block;">Edit your question below.</h3>
										<button type="button" class="close" data-dismiss="modal" aria-label="Close" style="display: inline-block;">
										<span aria-hidden="true">&times;</span>
										</button>
									</div>
									<div class="modal-body">
										<div class="form-group">
											<label for="subject-related" class="col-form-label pull-left"><b>Select a subject</b></label>
											<select class="form-control" id="editQuestionSubject" name="subject">
												<!-- {% for subject in subjects %}
													<option value="{{subject.name}}">{{subject.name}}</option>
													{% endfor %} -->
											</select>
										</div>
										<div class="form-group">
											<label for="question" class="col-form-label pull-left"><b>Question:</b></label>
											<textarea class="form-control" id="new_question" name="new_question" required></textarea>
										</div>
										<input type="text" name="question_id_to_update" id="question_id_to_update" hidden/>
										<div class="modal-footer">
											<button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
											<button type="submit" class="btn btn-primary" onclick="update_question();">Update my Question</button>
										</div>
									</div>
								</div>
							</div>
						</div>
						<div style="overflow-y: scroll; overflow-x: hidden; height:866px;" id="tutor_questions">
							{% if questionAndAnswers %} {% for qa in questionAndAnswers %}
							<div class="container question_answer_container_{{qa.id}}" style="width: auto;">
								<div id="question_answer_id_{{qa.id}}">
									<a href="/subject_tag/{{qa.subject}}" class="mtgtlDwEfX" style="display:inline-block;" id="qa_subject_{{qa.id}}">{{ qa.subject }}</a>
									{{ qa.questioner.first_name }} {{ qa.questioner.last_name }} asked a question at
									<p style="display:inline-block;" id="tool_tip_date_{{qa.id}}" data-toggle="tooltip" data-placement="top">{{ qa.date }}</p>
									<div class="dropdown pull-right" style="display:inline-block;">
										<!--Trigger-->
										<a class="btn-floating btn-lg black dropdown-toggle"type="button" id="dropdownMenu3" data-toggle="dropdown"
											aria-haspopup="true" aria-expanded="false"><i class="fas fa-ellipsis-v"></i></a>
										<br>
										<!--Menu-->
										<div class="dropdown-menu dropdown-primary">
											{% if qa.questioner.pk == user.pk %}
											<a class="dropdown-item" href="#" onclick="delete_question('{{qa.id}}');"><i class="fas fa-trash-alt"></i>&nbsp;&nbsp;Delete question</a>
											<a class="dropdown-item" href="#" data-toggle="modal" data-target="#editQuestionModal" onclick="updateEditQuestionModal('{{ qa.id }}');"><i class="fas fa-edit"></i>&nbsp;&nbsp;Edit question</a>
											{% endif %}
											<a class="dropdown-item" href="{% url 'tutoring:question_answer_thread' qa.id %}" target="_blank"><i class="fab fa-discourse"></i>&nbsp;&nbsp;View thread</a>
										</div>
									</div>
								</div>
								<div><strong id="qa_question_{{qa.id}}">{{ qa.question|linebreaksbr }}</strong></div>
								<br>
								<div style="width: 970px;" id="qa_answer_{{qa.id}}">{{ qa.answer|linebreaksbr }}</div>
								<br>
								<button id="comment_like_id_{{qa.id}}" type="button" class="btn btn-default btn-sm" onclick="like_comment('{{qa.id}}')">
								<i class='far fa-thumbs-up' style='font-size:15px'></i> ({{qa.likes.count}})
								</button>
								<button id="comment_dislike_id_{{qa.id}}" type="button" class="btn btn-default btn-sm" onclick="dislike_comment('{{qa.id}}')">
								<i class='far fa-thumbs-down' style='font-size:15px'></i> ({{qa.dislikes.count}})
								</button><br><br>
								<span class="badge badge-info" data-toggle="modal" data-target="#answerModal" onclick="updateAnswerModal('{{ qa.id }}');">Answer this question</span>
								<hr>
							</div>
							{% endfor %} {% endif %}
						</div>
					</div>
					<div class="tab-pane" id="tutor_reviews">
						<div class="bg-white rounded shadow-sm p-4 mb-4 clearfix graph-star-rating">
							<h5 class="mb-0 mb-4">Ratings and Reviews</h5>
							<div class="graph-star-rating-header">
								<div class="star-rating">
									<a href="#"><i class="icofont-ui-rating active"></i></a>
									<a href="#"><i class="icofont-ui-rating active"></i></a>
									<a href="#"><i class="icofont-ui-rating active"></i></a>
									<a href="#"><i class="icofont-ui-rating active"></i></a>
									<a href="#"><i class="icofont-ui-rating"></i></a> <b class="text-black ml-2">{{ tutorReviews.count }} total reviews</b>
								</div>
								<p class="text-black mb-4 mt-2">Rated 3.5 out of 5</p>
							</div>
							<div class="graph-star-rating-body">
								<div class="rating-list">
									<div class="rating-list-left text-black">
										5 Star
									</div>
									<div class="rating-list-center">
										<div class="progress">
											<div id="star-5-bar" style="width: 56%" aria-valuemax="5" aria-valuemin="0" aria-valuenow="5" role="progressbar" class="progress-bar bg-primary">
												<span class="sr-only">80% Complete (danger)</span>
											</div>
										</div>
									</div>
									<div id="star-5-value" class="rating-list-right text-black">56%</div>
								</div>
								<div class="rating-list">
									<div class="rating-list-left text-black">
										4 Star
									</div>
									<div class="rating-list-center">
										<div class="progress">
											<div id="star-4-bar" style="width: 23%" aria-valuemax="5" aria-valuemin="0" aria-valuenow="5" role="progressbar" class="progress-bar bg-primary">
												<span class="sr-only">80% Complete (danger)</span>
											</div>
										</div>
									</div>
									<div id="star-4-value" class="rating-list-right text-black">23%</div>
								</div>
								<div class="rating-list">
									<div class="rating-list-left text-black">
										3 Star
									</div>
									<div class="rating-list-center">
										<div class="progress">
											<div id="star-3-bar" style="width: 11%" aria-valuemax="5" aria-valuemin="0" aria-valuenow="5" role="progressbar" class="progress-bar bg-primary">
												<span class="sr-only">80% Complete (danger)</span>
											</div>
										</div>
									</div>
									<div id="star-3-value" class="rating-list-right text-black">11%</div>
								</div>
								<div class="rating-list">
									<div class="rating-list-left text-black">
										2 Star
									</div>
									<div class="rating-list-center">
										<div class="progress">
											<div id="star-2-bar" style="width: 2%" aria-valuemax="5" aria-valuemin="0" aria-valuenow="5" role="progressbar" class="progress-bar bg-primary">
												<span class="sr-only">80% Complete (danger)</span>
											</div>
										</div>
									</div>
									<div id="star-2-value" class="rating-list-right text-black">02%</div>
								</div>
								<div class="rating-list">
									<div class="rating-list-left text-black">
										1 Star
									</div>
									<div class="rating-list-center">
										<div class="progress">
											<div id="star-1-bar" style="width: 2%" aria-valuemax="5" aria-valuemin="0" aria-valuenow="5" role="progressbar" class="progress-bar bg-primary">
												<span class="sr-only">80% Complete (danger)</span>
											</div>
										</div>
									</div>
									<div id="star-1-value" class="rating-list-right text-black">02%</div>
								</div>
								<div class="rating-list">
									<div class="rating-list-left text-black">
										0 Star
									</div>
									<div class="rating-list-center">
										<div class="progress">
											<div id="star-0-bar" style="width: 2%" aria-valuemax="5" aria-valuemin="0" aria-valuenow="5" role="progressbar" class="progress-bar bg-primary">
												<span class="sr-only">80% Complete (danger)</span>
											</div>
										</div>
									</div>
									<div id="star-0-value" class="rating-list-right text-black">02%</div>
								</div>
							</div>
							<div class="graph-star-rating-footer text-center mt-3 mb-3">
								<button type="button" class="btn btn-outline-primary btn-sm" data-toggle="modal" data-target="#tutorReview">Rate and Review</button>
							</div>
						</div>
						<div class="bg-white rounded shadow-sm p-4 mb-4 restaurant-detailed-ratings-and-reviews">
							<select class="form-control pull-right" id="comment_filter" name="comment_filter" style="width:15%;" onchange="UpdateRatingOrder();">
								<option value="Recent Date">Recent Date</option>
								<option value="Likes">Likes</option>
								<option value="Dislikes">Dislikes</option>
								<option value="Rating">Rating</option>
							</select>
							<h5 class="mb-1">All Ratings and Reviews</h5>
							<div id="tutor_review_comment_section">
								
							</div>

							{# <a class="text-center w-100 d-block mt-4 font-weight-bold" href="#">See All Reviews</a> #}
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
<script type="text/javascript">
	window.onload = function() {
		update_subjects();
		CollectTutorReviewsHandler();
	}

	var list_of_reviews = [];

	function CollectTutorReviewsHandler() {
		var rating_value_count = [0, 0, 0, 0, 0, 0];
		var rating_value_percantage = [];

		{% for r in tutorReviews %}

			list_of_reviews.push({
				'pk': '{{r.id}}',
				'reviewer_id': '{{r.reviewer.id}}',
				'date': '{{r.date}}',
				'reviewer_full_name': '{{r.reviewer.get_full_name}}',
				'rating': eval('{{r.rating}}'),
				'comment': '{{r.comment|linebreaksbr}}',
				'likes_count': eval('{{r.likes.count}}'),
				'dislikes_count': eval('{{r.dislikes.count}}'),
				'edited': '{{r.edited}}' == "True" ? true : false,
				'can_edit': '{{ user.id }}' == '{{ r.reviewer.id }}' ? true : false,
			});

			rating_value_count[eval('{{r.rating}}')] += 1;

		{% endfor %}

		var total_count = rating_value_count.reduce((a, b) => a + b, 0);
		for(var i = 0; i <rating_value_count.length; i++) {
			rating_value_percantage.push(Math.round(rating_value_count[i]/total_count * 100));
		}
		DisplayReviewStatistics(rating_value_percantage);
		ParseTutorReviewToDisplay(list_of_reviews);
	}

	function DisplayReviewStatistics(statistics) {

		for (var i = 0; i < statistics.length; i++) {
			$('#star-'+i+'-bar').css("width", statistics[i]+"%");
			$('#star-'+i+'-value').text(statistics[i]+"%");
		}
	}

	function UpdateRatingOrder() {
		var filter_value = $('#comment_filter').val();

		switch(filter_value) {
			case "Recent Date":
				updateByRecentDate();
				break;
			case "Likes":
				updateByLikes();
				break;
			case "Dislikes":
				updateByDislikes();
				break;
			case "Rating":
				updateByRating();
				break;
			default:
				return;

		}
	}

	function updateByRecentDate() {
		ParseTutorReviewToDisplay(list_of_reviews);
	}

	function updateByLikes() {
		var new_array = list_of_reviews.slice();
		new_array.sort(SorByLikesInDescendingOrder);
		ParseTutorReviewToDisplay(new_array);
	}

	function updateByDislikes() {
		var new_array = list_of_reviews.slice();
		new_array.sort(SorByDislikesInDescendingOrder);
		ParseTutorReviewToDisplay(new_array);
	}

	function updateByRating() {
		var new_array = list_of_reviews.slice();
		new_array.sort(SorByRatingInDescendingOrder);
		ParseTutorReviewToDisplay(new_array);
	}

	function SorByRatingInDescendingOrder( a, b ) { if ( a.rating > b.rating ){ return -1; } if ( a.rating < b.rating ){ return 1; } return 0; }
	function SorByLikesInDescendingOrder( a, b ) { if ( a.likes_count > b.likes_count ){ return -1; } if ( a.likes_count < b.likes_count ){ return 1; } return 0; }
	function SorByDislikesInDescendingOrder( a, b ) { if ( a.dislikes_count > b.dislikes_count ){ return -1; } if ( a.dislikes_count < b.dislikes_count ){ return 1; } return 0; }

	function ParseTutorReviewToDisplay(list) {
		$('#tutor_review_comment_section').empty();

		if (list.length == 0)
			return;

		for (var i = 0; i < list.length; i++) {

			var edited_text = list[i].edited == true ? '(edited)' : '';
			var user_edit_dropdown = GetTutorReviewDropdownForUser(list[i].can_edit, list[i].pk);
			
			var new_comment = `
			<div class="reviews-members pt-4 pb-4" id="tutor_review_container_`+list[i].pk+`">
				<div class="media">
					<a href="#"><img alt="Generic placeholder image" src="http://bootdey.com/img/Content/avatar/avatar1.png" class="mr-3 rounded-pill"></a>
					<div class="media-body">
						<div class="reviews-members-header">
							`+user_edit_dropdown+`
							<h6 class="mb-1"><b>`+list[i].reviewer_full_name+`</b></h6>
							<p class="text-gray">`+list[i].date+` <span class="text-secondary" >`+edited_text+`</span></p>
						</div>
						<div class="reviews-members-body">
							<p>`+list[i].comment+`</p>
						</div>
						<div class="reviews-members-footer">
							<button type="button" class="btn btn-outline-primary" style="border-radius: 35px;"><i class="fa fa-thumbs-o-up"></i> `+list[i].likes_count+`</button>
							<button type="button" class="btn btn-outline-primary" style="border-radius: 35px;"><i class="fa fa-thumbs-o-down"></i> `+list[i].dislikes_count+`</button>
							&nbsp;&nbsp;
							`+GenerateStarsFromRating(list[i].rating);+`
						</div>
					</div>
				</div>
			</div>
			<hr>`;

			$('#tutor_review_comment_section').append( new_comment );
		}
	}

	function GetTutorReviewDropdownForUser(can_edit, component_id) {
		var response = `<div class="dropdown pull-right" style="display:inline-block;">
							<button type="button" class="btn btn-outline-primary dropdown-toggle" data-toggle="dropdown"
											aria-haspopup="true" aria-expanded="false"></button>
								<div class="dropdown-menu dropdown-primary">`;

		if (can_edit)
			response += `<span class="dropdown-item" onclick="DeleteTutorReviewComponent(`+component_id+`);"><i class="fas fa-trash-alt"></i>&nbsp;&nbsp;Delete</span>
						<span class="dropdown-item"><i class="fa fa-edit"></i>&nbsp;&nbsp;Edit</span>`;
		else
			response += '<span class="dropdown-item"><i class="fa fa-warning"></i>&nbsp;&nbsp;Report</span>';

		response+= `</div></div>`;
		return response;
	}

	function DeleteTutorReviewComponent(component_id) {
		$.ajax({
			data: {
				'functionality': 'delete_tutor_review',
				'review_id': component_id,
			},
			dataType: 'json',
			success: function (response) {
				if (response.status_code == 200 || response.status_code == 404) {
					removeTutorReviewFromGlobalReviewList(component_id);
				} else {
					Swal.fire({
						icon: 'error',
						title: "Can't do that!",
						text: response.message
					});
				}
			}
		});
	}

	function removeTutorReviewFromGlobalReviewList(component_id) {
		var new_list = [];
		var rating_value_count = [0, 0, 0, 0, 0, 0];
		var rating_value_percantage = [];
		// no the optimal solution for bigger arrays. 

		for (var i = 0; i < list_of_reviews.length; i++) {
			if (list_of_reviews[i].pk != component_id) {
				new_list.push(list_of_reviews[i]);
				rating_value_count[list_of_reviews[i].rating] += 1;
			}
		}

		var total_count = rating_value_count.reduce((a, b) => a + b, 0);
		for(var i = 0; i <rating_value_count.length; i++) {
			rating_value_percantage.push(Math.round(rating_value_count[i]/total_count * 100));
		}

		list_of_reviews = new_list;
		DisplayReviewStatistics(rating_value_percantage);
		ParseTutorReviewToDisplay(list_of_reviews);
	}

	function GenerateStarsFromRating(value) {
		var response = '';

		for (var i = 0; i < value; i++) {
			response += '<i class="fa fa-star" style="font-size:20px;color:lightgreen;"></i>&nbsp;';
		}
		return response;
	}

	function update_subjects() {
		{% for subject in tutorProfile.subjects %}
		var subject_name = "{{subject}}".replace(/\s+/g, '-');
		var subject_item = `
			<a href="/subject_tag/`+subject_name+`" style="margin: 0 10px 10px 0;">
				<dir class="mtgtlDwEfX">
					{{ subject }}
				</dir>
			</a>
			`;
		$( "#list_of_subjects" ).append( subject_item );
		{% endfor %}
	}

	function updateAnswerModal(questionId) {
		var answerText = $('#qa_answer_' + questionId).html();
		var questionText = $('#qa_question_' + questionId).html();
		var regex = /<br\s*[\/]?>/gi;
		document.getElementById('question_id').value = questionId;
		document.getElementById('question_text').value = questionText.replace(regex, "\n");
		document.getElementById('answer_text').value = answerText.replace(regex, "\n");
	}

	function updateEditQuestionModal(questionId) {
		var subjectText = $('#qa_subject_' + questionId).html();
		var questionText = $('#qa_question_' + questionId).html();
		var regex = /<br\s*[\/]?>/gi;

		// display correct subject in the dropdown
		{% for subject in subjects %}
			if (subjectText=='{{subject.name}}') {
				$("#editQuestionSubject").append('<option value="{{subject.name}}" selected>{{subject.name}}</option>');
			} else {
				$("#editQuestionSubject").append('<option value="{{subject.name}}">{{subject.name}}</option>');
			}
		{% endfor %}

		// display correct question text and question id in the modal
		document.getElementById('new_question').value = questionText.replace(regex, "\n");
		document.getElementById('question_id_to_update').value = questionId;
	}

	function update_question() {
		var subject = $('#editQuestionSubject').find(":selected").text();
		var question = $('textarea#new_question').val();
		question = question.replace(/ +(?= )/g,'');
		question = question.trim();


		if (question && !question.trim() || question.length==0) {
			alert("Enter a question!");
			return;
		}

		// closing the modal and clearing the textarea
		$("#editQuestionModal").modal('hide');
		$("textarea#new_question").val("");

		$.ajax({
			data: {
				'functionality': 'update_question',
				'question_id': $('#question_id_to_update').val(),
				'new_subject': subject,
				'new_question': question,
			},
			dataType: 'json',
			success: function (response) {
				if (response.status_code == 200) {
					var this_qa = eval(response.this_qa)[0];
					var new_question = this_qa.fields.question;
					new_question = new_question.replace(/\n\r?/g, '<br />');
					$('strong#qa_question_'+$('#question_id_to_update').val()).html(new_question);
					$('#qa_subject_'+$('#question_id_to_update').val()).html(this_qa.fields.subject);
					$('#qa_subject_'+$('#question_id_to_update').val()).attr("href", "/subject_tag/"+this_qa.fields.subject);

				} else if (response.status_code == 404) {
					Swal.fire({
						icon: 'error',
						title: "Can't do that!",
						text: response.message
					});
					$( ".question_answer_container_"+$('#question_id_to_update').val() ).remove();
				}
			}
		});
	}

	function like_comment(commentId) {
		$.ajax({
			data: {
				'functionality': 'like_comment',
				'commentId': commentId
			},
			dataType: 'json',
			success: function (response) {
				if (response.status_code == 200) {
					var this_comment = eval(response.this_comment)[0];
					var number_of_likes = this_comment.fields.likes.length;
					var number_of_dislikes = this_comment.fields.dislikes.length;

					$('#comment_like_id_'+commentId).html('<i class="far fa-thumbs-up" style="font-size:15px"></i> ('+ number_of_likes +')');
					$('#comment_dislike_id_'+commentId).html('<i class="far fa-thumbs-down" style="font-size:15px"></i> ('+ number_of_dislikes +')');

				} else if (response.status_code == 401) {
					Swal.fire({
						icon: 'warning',
						title: "Can't do that!",
						text: response.message
					});

				} else if (response.status_code == 403) {
					Swal.fire({
						icon: 'error',
						title: "Can't do that!",
						text: response.message
					});
				} else if (response.status_code == 404) {
					Swal.fire({
						icon: 'error',
						title: "Can't do that!",
						text: response.message
					});
					$( ".question_answer_container_"+commentId ).remove();
				}
			}
		});
	}

	function dislike_comment(commentId) {
		$.ajax({
			data: {
				'functionality': 'dislike_comment',
				'commentId': commentId
			},
			dataType: 'json',
			success: function (response) {
				if(response.status_code == 200) {
					var this_comment = eval(response.this_comment)[0];
					var number_of_likes = this_comment.fields.likes.length;
					var number_of_dislikes = this_comment.fields.dislikes.length;

					$('#comment_like_id_'+commentId).html('<i class="far fa-thumbs-up" style="font-size:15px"></i> ('+ number_of_likes +')');
					$('#comment_dislike_id_'+commentId).html('<i class="far fa-thumbs-down" style="font-size:15px"></i> ('+ number_of_dislikes +')');

				} else if (response.status_code == 401) {
					Swal.fire({
						icon: 'warning',
						title: "Can't do that!",
						text: response.message
					});

				} else if (response.status_code == 403) {
					Swal.fire({
						icon: 'error',
						title: "Can't do that!",
						text: response.message
					});
				} else if (response.status_code == 404) {
					Swal.fire({
						icon: 'error',
						title: "Can't do that!",
						text: response.message
					});
					$( ".question_answer_container_"+commentId ).remove();
				}
			}
		});
	}

	function post_question() {
		var subject = $('#subject').find(":selected").text();
		var question = $('textarea#question').val();
		question = question.replace(/ +(?= )/g,'');
		question = question.trim();

		if (question && !question.trim() || question.length==0) {
			alert("Enter a question!");
			return;
		}

		// closing the modal and clearing the textarea
		$("#questionModal").modal('hide');
		$("textarea#question").val("");
		
		$.ajax({
			// url: '{% url "tutoring:viewtutorprofile" tutorProfile.secondary_key %}',
			data: {
				'functionality': 'post_question',
				'subject': subject,
				'question': question,
			},
			dataType: 'json',
			success: function (response) {
				if (response.status_code == 200) {
					var new_qa = eval(response.new_qa)[0];

					var new_question_text = `
						<div class="container question_answer_container_`+new_qa.pk+`" style="width: auto;">
							<div id="question_answer_id_`+new_qa.pk+`">
								<a href="/subject_tag/`+new_qa.fields.subject+`" class="mtgtlDwEfX" style="display:inline-block;" id="qa_subject_`+new_qa.pk+`">`+new_qa.fields.subject+`</a>
								`+response.questioner_first_name+ " " +response.questioner_last_name+` asked a question at
								<p style="display:inline-block;" id="tool_tip_date_`+new_qa.pk+`" data-toggle="tooltip" data-placement="top">`+response.created_date+`</p>
								<div class="dropdown pull-right" style="display:inline-block;">
									<a class="btn-floating btn-lg black dropdown-toggle"type="button" id="dropdownMenu3" data-toggle="dropdown"
										aria-haspopup="true" aria-expanded="false"><i class="fas fa-ellipsis-v"></i></a>
									<br>
									<div class="dropdown-menu dropdown-primary">
										<a class="dropdown-item" href="#" onclick="delete_question('`+new_qa.pk+`');"><i class="fas fa-trash-alt"></i>&nbsp;&nbsp;Delete question</a>
										<a class="dropdown-item" href="#" data-toggle="modal" data-target="#editQuestionModal" onclick="updateEditQuestionModal('`+new_qa.pk+`');"><i class="fas fa-edit"></i>&nbsp;&nbsp;Edit question</a>
										<a class="dropdown-item" href="/question_answer_thread/`+new_qa.pk+`" target="_blank"><i class="fab fa-discourse"></i>&nbsp;&nbsp;Answer in a thread</a>
									</div>
								</div>
							</div>
							
							<div><strong id="qa_question_`+new_qa.pk+`">`+new_qa.fields.question.replace(/\n\r?/g, '<br />')+`</strong></div>
							<br>
							<div style="width: 970px;" id="qa_answer_`+new_qa.pk+`">`+new_qa.fields.answer.replace(/\n\r?/g, '<br />')+`</div><br>
							<button id="comment_like_id_`+new_qa.pk+`" type="button" class="btn btn-default btn-sm" onclick="like_comment('`+new_qa.pk+`')">
								<i class='far fa-thumbs-up' style='font-size:15px'></i> (`+new_qa.fields.likes.length+`)
							</button>
							<button id="comment_dislike_id_`+new_qa.pk+`" type="button" class="btn btn-default btn-sm" onclick="dislike_comment('`+new_qa.pk+`')">
								<i class='far fa-thumbs-down' style='font-size:15px'></i> (`+new_qa.fields.dislikes.length+`)
							</button><br><br>
							<span class="badge badge-info" data-toggle="modal" data-target="#answerModal" onclick="updateAnswerModal('`+new_qa.pk+`');">Answer this question</span><hr>
						</div>`;

					$( "#tutor_questions" ).prepend( new_question_text );

				} else if (response.status_code == 401) {
					Swal.fire({
						icon: 'warning',
						title: "Can't do that!",
						text: response.message
					});

				}
			}
		});
	}

	function post_answer() {
		var new_answer = $('textarea#answer_text').val();
		new_answer = new_answer.trim();

		if (new_answer && !new_answer.trim() || new_answer.length==0) {
			alert("Enter an answer!");
			return;
		}

		$("#answerModal").modal('hide');

		$.ajax({
			data: {
				'functionality': 'post_answer',
				'question_id': $('#question_id').val(),
				'new_answer': new_answer,
			},
			dataType: 'json',
			success: function (response) {
				if (response.status_code == 200) {
					var this_qa = eval(response.this_qa)[0];
					var new_ans = this_qa.fields.answer;
					new_ans = new_ans.replace(/\n\r?/g, '<br />');
					$('div#qa_answer_'+$('#question_id').val()).html(new_ans);

				} else if (response.status_code == 401) {
					Swal.fire({
						icon: 'warning',
						title: "Can't do that!",
						text: response.message
					});

				} else if (response.status_code == 404) {
					Swal.fire({
						icon: 'error',
						title: "Can't do that!",
						text: response.message
					});
					$( ".question_answer_container_"+$('#question_id').val() ).remove();
				}
			}
		});
	}

	function delete_question(question_id) {
		$.ajax({
			data: {
				'functionality': 'delete_question',
				'question_id': question_id
			},
			dataType: 'json',
			success: function (response) {
				if (response.status_code == 200 || response.status_code == 404) {
					$( ".question_answer_container_"+question_id ).remove();
				} else {
					Swal.fire({
						icon: 'error',
						title: "Can't do that!",
						text: response.message
					});
				}
			}
		});
	}

	function StartMessage() {
		$.ajax({
			data: {
				'functionality': 'start_message',
				'participant_id': '{{ tutorProfile.user.id }}',
			},
			url: '{% url "chat:startmessage" %}',
			dataType: 'json',
			success: function (response) {
				if (response.status_code == 200) {

					document.location.href = '{% url "chat:chatpage" %}';

				} else if (response.status_code == 401) {
					Swal.fire({
						icon: 'error',
						title: "Can't do that!",
						text: response.message
					});
				} else {
					Swal.fire({
						icon: 'warning',
						title: "Can't do that!",
						text: response.message
					});
				}
			}
		});
	}
</script>
{% endblock %}