{% extends "accounts/account_base.html" %}
{% load static %}
{% block content %}
<link rel="stylesheet" type="text/css" href="{% static 'css/tab_pane.css' %}" />
<style type="text/css">
	/***
		User Profile Sidebar by @keenthemes
		A component of Metronic Theme - #1 Selling Bootstrap 3 Admin Theme in Themeforest: http://j.mp/metronictheme
		Licensed under MIT
	***/
	.nav-tabs>li{width:50%;text-align:center}.profile{margin:20px 0}.profile-sidebar{padding:20px 0 10px 0;background:#fff}.profile-userpic img{float:none;margin:0 auto;width:50%;height:50%;-webkit-border-radius:50%!important;-moz-border-radius:50%!important;border-radius:50%!important}.profile-usertitle{text-align:center;margin-top:20px}.profile-usertitle-name{color:#5a7391;font-size:16px;font-weight:600;margin-bottom:7px}.profile-usertitle-job{text-transform:uppercase;color:#5b9bd1;font-size:12px;font-weight:600;margin-bottom:15px}.profile-userbuttons{text-align:center;margin-top:10px}.profile-userbuttons .btn{text-transform:uppercase;font-size:11px;font-weight:600;padding:6px 15px;margin-right:5px}.profile-userbuttons .btn:last-child{margin-right:0}.profile-usermenu{margin-top:30px}.profile-usermenu ul li{border-bottom:1px solid #f0f4f7}.profile-usermenu ul li:last-child{border-bottom:0}.profile-usermenu ul li p{color:#5b9bd1;font-size:15px;font-weight:600;margin-left:15px}.profile-usermenu ul li p i{margin-right:8px;font-size:14px}.profile-usermenu ul li p:hover{background-color:#fafcfd;color:#5b9bd1}.profile-usermenu ul li.active{border-bottom:0}.profile-usermenu ul li.active a{color:#5b9bd1;background-color:#f6f9fb;border-left:2px solid #5b9bd1;margin-left:-2px}.profile-content{background:#fff;min-height:460px}.tutor_Answer__1aisT:not(:first-child){margin-top:16px}.feed_question_Component__1AuPU{position:relative;display:flex;flex-direction:column;width:100%;--vPad:14px;--hPad:20px}.feed_question_Component__1AuPU:not(:first-child){margin-top:16px}@media(min-width:768px){.feed_question_Component__1AuPU{--vPad:14px;--hPad:27px}.feed_question_Question_Title__2OHwe{margin:21px 0 0}.feed_question_Question_Answer__2E1dk{font:400 14px/21px Tenon;margin:22px 50px 25px 0}}.feed_question_Question__1SU6V{position:relative;padding:var(--vPad) var(--hPad);background-color:#fff}.feed_subject_badge_FeedSubjectBadge__HZ_pL{padding:3px 8px;border-radius:4px;text-align:center;font:500 9px/11px Tenon;color:#fff;background-color:#000;opacity:.64}.feed_question_Subject__1D7HM{z-index:5;position:absolute;top:var(--vPad);right:var(--hPad)}.feed_question_Question_Asker__3hFgj{font:400 11px/13px Tenon;color:#3b3b3b;opacity:.5;margin:0}@media(min-width:768px){.feed_question_Component__1AuPU{--vPad:14px;--hPad:27px}.feed_question_Question_Title__2OHwe{margin:21px 0 0}.feed_question_Question_Answer__2E1dk{font:400 14px/21px Tenon;margin:22px 50px 25px 0}}.feed_question_Question_Title__2OHwe{margin:15px 0 0;font:500 15px/18px Tenon;color:#3b3b3b;opacity:1}.feed_question_Question_Answer__2E1dk{text-align:left;white-space:pre-line;font:400 13px/18px Tenon;color:#4c4c4c;opacity:1;margin:15px 0 20px}.feed_question_Question_Answer__2E1dk>p:last-child{margin-bottom:0}@media(min-width:768px){.feed_question_Component__1AuPU{--vPad:14px;--hPad:27px}.feed_question_Question_Title__2OHwe{margin:21px 0 0}.feed_question_Question_Answer__2E1dk{font:400 14px/21px Tenon;margin:22px 50px 25px 0}}
	.qaSubjects{margin: -13px 10px 10px 0; font-size: 12px; padding: 3px 8px; border-radius: 4px; text-align: center; color: #fff; background-color: #000; opacity: .64;}
	@media (min-width: 1200px){
		.container {
		    width: 1500px;
		}
	}
</style>
<div class="container">
	<div class="row profile">
		<div class="col-md-3">
			<div class="profile-sidebar">
				<!-- SIDEBAR USERPIC -->
				<div class="profile-userpic">
					{% if tutorProfile.profilePicture %}
					<img src="{{ tutorProfile.profilePicture.url }}" class="img-responsive" style="width:100px;" alt="" />
					{% else %}
					<img src="https://icon-library.com/images/default-user-icon/default-user-icon-13.jpg" class="img-responsive" style="width:100px;" alt="" />
					{% endif %}
				</div>
				<!-- END SIDEBAR USERPIC -->
				<!-- SIDEBAR USER TITLE -->
				<div class="profile-usertitle">
					<div class="profile-usertitle-name">
						{{ tutorProfile.user.first_name }} {{ tutorProfile.user.last_name }}
					</div>
					<div class="profile-usertitle-job">
						{{ tutorProfile.summary }}
					</div>
				</div>
				<!-- END SIDEBAR USER TITLE -->
				<!-- SIDEBAR BUTTONS -->
				<div class="profile-userbuttons">
					<div class="modal fade" id="questionModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
						<div class="modal-dialog">
							<div class="modal-content">
								<div class="modal-header">
									<h3 class="modal-title" id="exampleModalLabel" style="display: inline-block;">Enter your Question below.</h3>
									<button type="button" class="close" data-dismiss="modal" aria-label="Close" style="display: inline-block;">
										<span aria-hidden="true">&times;</span>
									</button>
								</div>
								<div class="modal-body">
									<form method="post">
										{% csrf_token %}
										<div class="form-group">
											<label for="subject-related" class="col-form-label pull-left">Select a subject</label>
											<select class="form-control" id="subject" name="subject">
												{% for subject in subjects %}
												<option value="{{subject.name}}">{{subject.name}}</option>
												{% endfor %}
											</select>
										</div>
										<div class="form-group">
											<label for="question" class="col-form-label pull-left">Question:</label>
											<textarea class="form-control" id="question" name="question" required></textarea>
										</div>
										<input type="text" name="postQuestion" hidden />
										<div class="modal-footer">
											<button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
											<button type="submit" class="btn btn-success">Post my Question</button>
										</div>
									</form>
								</div>
							</div>
						</div>
					</div>
					<button type="button" class="btn btn-success btn-sm" data-toggle="modal" data-target="#questionModal">Ask a Question</button>
					<button type="button" class="btn btn-danger btn-sm">Message</button>
				</div>
				<!-- END SIDEBAR BUTTONS -->
				<!-- SIDEBAR MENU -->
				<div class="profile-usermenu">
					<ul class="nav">
						<li>
							<p>Tutor Score - 100</p>
						</li>
						<li>
							<p>Charges Â£25 per hour</p>
						</li>
						<li>
							<p>25 Questions Answered</p>
						</li>
						<li>
							<p>Tuitoned 25 students</p>
						</li>
					</ul>
				</div>
				<!-- END MENU -->
			</div>
		</div>
		<div class="col-md-9">
			<div class="profile-content">
				<div class="row">
					<div class="col-md-12">
						<!-- Nav tabs -->
						<div class="card">
							<ul class="nav nav-tabs" role="tablist">
								<li role="presentation" class="active">
									<a href="#profile" aria-controls="profile" role="tab" data-toggle="tab"> <span>Profile</span></a>
								</li>
								<li role="presentation">
									<a href="#messages" aria-controls="messages" role="tab" data-toggle="tab"> <span>Q & A</span></a>
								</li>
							</ul>
							<!-- Tab panes -->
							<div class="tab-content">
								<div role="tabpanel" class="tab-pane active" id="profile">
									<div>
										<h3>About</h3>
										<p>{{ tutorProfile.about|linebreaksbr }}</p>
									</div>
									<hr />
									<div>
										<h3>Education</h3>
										<div>
											{% for key,value in tutorProfile.education.items %}
											<div style="display: flex; flex-direction: row; align-items: flex-start; justify-content: flex-start; margin-bottom: 15px;">
												<img
													src="https://www.iconfinder.com/data/icons/building-1/512/build2-512.png"
													style="width: 50px; height: 50px; margin-right: 13px; -o-object-fit: contain; object-fit: contain; border-radius: 4px;"
												/>
												<div style="flex: 1 1; flex-direction: column;">
													<b style="margin-bottom: 5px;">{{value.school_name}}</b>
													<p style="margin-bottom: 0;">{{value.qualification}} ({{value.year}})</p>
												</div>
											</div>
											{% endfor %}
										</div>
									</div>
									<hr />
									<div>
										<div class="row">
					                        <div class="col-xs-6">
					                           <h3 for="availability">Availability</h3>
					                           <table class="table" id="availabilitySchedule" style="width: auto;">
					                              <thead>
					                                 <tr>
					                                    <th scope="col"></th>
					                                    <th scope="col">Morning</th>
					                                    <th scope="col">Afternoon</th>
					                                    <th scope="col">Evening</th>
					                                 </tr>
					                              </thead>
					                              <tbody>
					                                 {% for key,value in tutorProfile.availability.items %}
					                                 <tr>
					                                    <th style="vertical-align: middle;" scope="row">{{key|title}}</th>
					                                    <td style="text-align: center">
					                                       {% if value.morning %}
					                                       <div class="btn-group" data-toggle="buttons">
					                                          <label class="btn btn-success" disabled>
					                                          <span class="glyphicon glyphicon-ok"></span>
					                                          </label>
					                                       </div>
					                                       {% else %}
					                                       <div class="btn-group" data-toggle="buttons">
					                                          <label class="btn btn-danger" disabled>
					                                          <span class="glyphicon glyphicon-remove"></span>
					                                          </label>
					                                       </div>
					                                       {% endif %}
					                                    </td>
					                                    <td style="text-align: center">
					                                       {% if value.afternoon %}
					                                       <div class="btn-group" data-toggle="buttons">
					                                          <label class="btn btn-success" disabled>
					                                          <span class="glyphicon glyphicon-ok"></span>
					                                          </label>
					                                       </div>
					                                       {% else %}
					                                       <div class="btn-group" data-toggle="buttons">
					                                          <label class="btn btn-danger" disabled>
					                                          <span class="glyphicon glyphicon-remove"></span>
					                                          </label>
					                                       </div>
					                                       {% endif %}
					                                    </td>
					                                    <td style="text-align: center">
					                                       {% if value.evening %}
					                                       <div class="btn-group" data-toggle="buttons">
					                                          <label class="btn btn-success" disabled>
					                                          <span class="glyphicon glyphicon-ok"></span>
					                                          </label>
					                                       </div>
					                                       {% else %}
					                                       <div class="btn-group" data-toggle="buttons">
					                                          <label class="btn btn-danger" disabled>
					                                          <span class="glyphicon glyphicon-remove"></span>
					                                          </label>
					                                       </div>
					                                       {% endif %}
					                                    </td>
					                                 </tr>
					                                 {% endfor %}
					                              </tbody>
					                           </table>
					                        </div>
					                        <div class="col-xs-6">
					                           <h3>Subjects</h3>
					                           <div style="display: flex; flex-flow: row wrap;">
					                              {% for subject in tutorProfile.subjects %}
					                              <a href="" style="margin: 0 10px 10px 0;">
					                                 <dir style="font-size: 12px; padding: 3px 8px; border-radius: 4px; text-align: center; color: #fff; background-color: #000; opacity: .64;">
					                                    {{ subject }}
					                                 </dir>
					                              </a>
					                              {% endfor %}
					                           </div>
					                        </div>
					                     </div>
									</div>
								</div>
								<div role="tabpanel" class="tab-pane" id="messages">
									<div class="modal fade" id="answerModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
										<div class="modal-dialog">
											<div class="modal-content">
												<div class="modal-header">
													<h3 class="modal-title" id="exampleModalLabel" style="display: inline-block;">Answer the Question below.</h3>
													<button type="button" class="close" data-dismiss="modal" aria-label="Close" style="display: inline-block;">
														<span aria-hidden="true">&times;</span>
													</button>
												</div>
												<div class="modal-body">
													<form method="post">
														{% csrf_token %}
														<div class="form-group">
															<label for="questionText" class="col-form-label pull-left">Question</label>
															<textarea class="form-control" id="questionText" name="questionText" readonly></textarea>
														</div>
														<div class="form-group">
															<label for="answerText" class="col-form-label pull-left">Answer</label>
															<textarea class="form-control" id="answerText" name="answerText" required></textarea>
														</div>
														<input type="text" name="postAnswer" hidden/>
														<input type="text" name="questionId" id="questionId" hidden/>
														<div class="modal-footer">
															<button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
															<button type="submit" class="btn btn-success">Post my Answer</button>
														</div>
													</form>
												</div>
											</div>
										</div>
									</div>
									<div style="overflow-y: scroll; overflow-x: hidden; height:866px;">
									{% if questionAndAnswers %} {% for qa in questionAndAnswers %}
										<div class="container">
											<div> {{ qa.questioner.first_name }} {{ qa.questioner.last_name }} asked a question about <a href="#" class="qaSubjects">{{ qa.subject }}</a>at {{ qa.date }}</div>
											<br>
											<div><strong>{{ qa.question|linebreaksbr }}</strong></div>
											<br>
											<div style="width: 970px;">{{ qa.answer|linebreaksbr }}</div><br>
											<button id="comment_like_id_{{qa.id}}" type="button" class="btn btn-default btn-sm" onclick="like_comment('{{qa.id}}')">
												<span class="glyphicon glyphicon-thumbs-up"></span> ({{qa.likes.count}})
											</button>
											<button id="comment_dislike_id_{{qa.id}}" type="button" class="btn btn-default btn-sm" onclick="dislike_comment('{{qa.id}}')">
												<span class="glyphicon glyphicon-thumbs-down"></span> ({{qa.dislikes.count}})
											</button><br><br>
											<span class="badge badge-info" data-toggle="modal" data-target="#answerModal" onclick="updateAnswerModal('{{ qa.id }}', '{{ qa.question|linebreaksbr }}', '{{ qa.answer|linebreaksbr }}');">Answer this question</span>
										</div>
										<hr>
									{% endfor %} {% endif %}
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
<script type="text/javascript">
	function updateAnswerModal(questionId, questionText, answerText) {
		document.getElementById('questionId').value = questionId;
		document.getElementById('questionText').value = questionText;
		document.getElementById('answerText').value = answerText;
	}

	function like_comment(commentId) {
		$.ajax({
			url: '{% url "tutoring:like_comment" %}',
			data: {
				'commentId': commentId
			},
			dataType: 'json',
			success: function (response) {
				if(response.status_code == 200) {
					var this_comment = eval(response.this_comment)[0];
					var number_of_likes = this_comment.fields.likes.length;
					var number_of_dislikes = this_comment.fields.dislikes.length;

					$('#comment_like_id_'+commentId).html('<span class="glyphicon glyphicon-thumbs-up"></span> ('+ number_of_likes +')');
					$('#comment_dislike_id_'+commentId).html('<span class="glyphicon glyphicon-thumbs-down"></span> ('+ number_of_dislikes +')');
	            }
			}
		});
	}

	function dislike_comment(commentId) {
		$.ajax({
			url: '{% url "tutoring:dislike_comment" %}',
			data: {
				'commentId': commentId
			},
			dataType: 'json',
			success: function (response) {
				if(response.status_code == 200) {
					var this_comment = eval(response.this_comment)[0];
					var number_of_likes = this_comment.fields.likes.length;
					var number_of_dislikes = this_comment.fields.dislikes.length;
					console.log(number_of_likes, number_of_dislikes);

					$('#comment_like_id_'+commentId).html('<span class="glyphicon glyphicon-thumbs-up"></span> ('+ number_of_likes +')');
					$('#comment_dislike_id_'+commentId).html('<span class="glyphicon glyphicon-thumbs-down"></span> ('+ number_of_dislikes +')');
				}
			}
		});
	}
</script>
{% endblock %}