{% extends "accounts/account_base.html" %}
{% load static %}
{% block content %}
<link rel="stylesheet" type="text/css" href="{% static 'css/tutoringMainpage.css' %}"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/MaterialDesign-Webfont/4.9.95/css/materialdesignicons.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-nice-select/1.1.0/js/jquery.nice-select.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-nice-select/1.1.0/css/nice-select.min.css"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ion-rangeslider/2.3.1/js/ion.rangeSlider.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ion-rangeslider/2.3.1/css/ion.rangeSlider.min.css"/>

<div class="container">
	{% if tutorList %}
		<br><br>
		<form method="post">
			{% csrf_token %}
			<div class="form-row" style="background: rgba(0, 0, 0, 0.5); padding: 43px 43px; padding-top: 40px;">
				<div class="col-11">
					<input style="border-radius: 0.5px;" type="text" class="form-control" name="generalQuery" placeholder="Try 'GCES Maths'" value="{{ generalQuery }}">
				</div>
				<div class="col">
					<input style="border-radius: 0.5px;" class="btn btn-primary" type="submit" value="Submit" style="background-color: #4272d7;">
				</div>
			</div>
		</form>
		<hr>
		<br>
        <div class="container">
           <div class="row align-items-center">
              <div class="col-lg-12">
                 <div class="show-results mt-5">
                    <div class="float-left">
                       <h5 class="text-dark mb-0 pt-2">Showing  Results : 1-6 of 540</h5>
                    </div>
                    <div class="sort-button float-right">
                       <ul class="list-inline mb-0">
                          <li class="list-inline-item mr-3">
                             <select class="nice-select" >
                                <option data-display="Sort By">Nothing</option>
                                <option value="1">Web Developer</option>
                                <option value="2">PHP Developer</option>
                                <option value="3">Web Designer</option>
                             </select>
                          </li>
                          <li class="list-inline-item">
                             <select class="nice-select">
                                <option data-display="Default">Nothing</option>
                                <option value="1">Web Developer</option>
                                <option value="2">PHP Developer</option>
                                <option value="3">Web Designer</option>
                             </select>
                          </li>
                       </ul>
                    </div>
                 </div>
              </div>
           </div>
           <div class="row">
              <div class="col-lg-3">
                 <div class="left-sidebar">
                    <div class="accordion" id="accordionExample">
                       <div class="card mt-4">
                          <button type="button" class="btn btn-primary btn-block" onclick="searchBySubjectAndFilter();">Update Filter</button>
                          <a data-toggle="collapse" href="#collapseOne" class="job-list" aria-expanded="true" aria-controls="collapseOne">
                             <div class="card-header" id="headingOne">
                                <h6 class="mb-0 text-dark f-18">Features</h6>
                             </div>
                          </a>
                          <div id="collapseOne" class="collapse show" aria-labelledby="headingOne">
                             <div class="card-body p-0">
                                <div class="custom-control custom-checkbox">
                                   <input type="checkbox" class="custom-control-input all-select" id="features-all-type">
                                   <label class="custom-control-label ml-1 text-muted f-15" for="features-all-type">All Type</label>
                                </div>
                                <div class="custom-control custom-checkbox">
                                   <input type="checkbox" class="custom-control-input all-select" id="features-pro">
                                   <label class="custom-control-label ml-1 text-muted f-15" for="features-pro">Pro</label>
                                </div>
                                <div class="custom-control custom-checkbox">
                                   <input type="checkbox" class="custom-control-input all-select" id="features-onlineLessons">
                                   <label class="custom-control-label ml-1 text-muted f-15" for="features-onlineLessons">Online Lessons</label>
                                </div>
                                <div class="custom-control custom-checkbox">
                                   <input type="checkbox" class="custom-control-input all-select" id="features-inPersonLessons">
                                   <label class="custom-control-label ml-1 text-muted f-15" for="features-inPersonLessons">In Person Lessons</label>
                                </div>
                             </div>
                          </div>
                       </div>
                       <div class="card mt-4">
                          <a data-toggle="collapse" href="#collapseOne" class="job-list" aria-expanded="true" aria-controls="collapseOne">
                             <div class="card-header" id="headingOne">
                                <h6 class="mb-0 text-dark f-18">Price</h6>
                             </div>
                          </a>
                          <br>
                          <div id="collapseOne" class="collapse show" aria-labelledby="headingOne">
                             <div class="card-body p-0">
                                <div class="container">
                                   <input type="text" class="js-range-slider-price" name="my_range" value="" />
                                </div>
                             </div>
                          </div>
                       </div>
                       <div class="card mt-4">
                          <a data-toggle="collapse" href="#collapseOne" class="job-list" aria-expanded="true" aria-controls="collapseOne">
                             <div class="card-header" id="headingOne">
                                <h6 class="mb-0 text-dark f-18">Tutor Score</h6>
                             </div>
                          </a>
                          <br>
                          <div id="collapseOne" class="collapse show" aria-labelledby="headingOne">
                             <div class="card-body p-0">
                                <div class="container">
                                   <input type="text" class="js-range-slider-score" name="my_range" value="" />
                                </div>
                             </div>
                          </div>
                       </div>
                       <div class="card mt-4">
                          <a data-toggle="collapse" href="#collapsetwo" class="job-list" aria-expanded="true" aria-controls="collapsetwo">
                             <div class="card-header" id="headingtwo">
                                <h6 class="mb-0 text-dark f-18">My Education Level</h6>
                             </div>
                          </a>
                          <div id="collapsetwo" class="collapse show" aria-labelledby="headingtwo">
                             <div class="card-body p-0">
                                <div class="custom-control custom-checkbox">
                                   <input type="checkbox" class="custom-control-input" id="customCheck5">
                                   <label class="custom-control-label ml-1 text-muted f-15" for="customCheck5">Primary</label>
                                </div>
                                <div class="custom-control custom-checkbox">
                                   <input type="checkbox" class="custom-control-input" id="customCheck6">
                                   <label class="custom-control-label ml-1 text-muted f-15" for="customCheck6">Secondary</label>
                                </div>
                                <div class="custom-control custom-checkbox">
                                   <input type="checkbox" class="custom-control-input" id="customCheck7">
                                   <label class="custom-control-label ml-1 text-muted f-15" for="customCheck7">GCSE</label>
                                </div>
                                <div class="custom-control custom-checkbox">
                                   <input type="checkbox" class="custom-control-input" id="customCheck8">
                                   <label class="custom-control-label ml-1 text-muted f-15" for="customCheck8">A-Level</label>
                                </div>
                                <div class="custom-control custom-checkbox">
                                   <input type="checkbox" class="custom-control-input" id="customCheck9">
                                   <label class="custom-control-label ml-1 text-muted f-15" for="customCheck9">Undergraduate</label>
                                </div>
                                <div class="custom-control custom-checkbox">
                                   <input type="checkbox" class="custom-control-input" id="customCheck10">
                                   <label class="custom-control-label ml-1 text-muted f-15" for="customCheck10">Other</label>
                                </div>
                             </div>
                          </div>
                       </div>
                       <div class="card mt-4">
                          <a data-toggle="collapse" href="#collapsetwo" class="job-list" aria-expanded="true" aria-controls="collapsetwo">
                             <div class="card-header" id="headingtwo">
                                <h6 class="mb-0 text-dark f-18">Qualification</h6>
                             </div>
                          </a>
                          <div id="collapsetwo" class="collapse show" aria-labelledby="headingtwo">
                             <div class="card-body p-0">
                                <div class="custom-control custom-checkbox">
                                   <input type="checkbox" class="custom-control-input" id="customCheck19">
                                   <label class="custom-control-label ml-1 text-muted f-15" for="customCheck19">Higher Secondary</label>
                                </div>
                                <div class="custom-control custom-checkbox">
                                   <input type="checkbox" class="custom-control-input" id="customCheck20">
                                   <label class="custom-control-label ml-1 text-muted f-15" for="customCheck20">Bachelor Degree</label>
                                </div>
                                <div class="custom-control custom-checkbox">
                                   <input type="checkbox" class="custom-control-input" id="customCheck21">
                                   <label class="custom-control-label ml-1 text-muted f-15" for="customCheck21">Master Degree</label>
                                </div>
                             </div>
                          </div>
                       </div>
                    </div>
                 </div>
              </div>
              <div class="col-lg-9">
                 <div class="candidates-listing-item" id="candidates-listing-item">
                 </div>
              </div>
           </div>
           <div class="row">
              <div class="col-lg-12">
                 <nav aria-label="Page navigation example">
                    <ul class="pagination job-pagination justify-content-center mt-5 mb-5">
                       <li class="page-item disabled">
                          <a class="page-link" href="#" tabindex="-1" aria-disabled="true">
                          <i class="mdi mdi-chevron-double-left f-15"></i>
                          </a>
                       </li>
                       <li class="page-item active"><a class="page-link" href="#">1</a></li>
                       <li class="page-item"><a class="page-link" href="#">2</a></li>
                       <li class="page-item"><a class="page-link" href="#">3</a></li>
                       <li class="page-item"><a class="page-link" href="#">4</a></li>
                       <li class="page-item">
                          <a class="page-link" href="#">
                          <i class="mdi mdi-chevron-double-right f-15"></i>
                          </a>
                       </li>
                    </ul>
                 </nav>
              </div>
           </div>
        </div>
	{% else %}
	<br>
		{% if messages %}
            {% for message in messages %}
            	{% if message.tags == "error" %}
            	<div style="color: black; text-align: center;" class="alert alert-danger" role="alert">{{message}}</div>
            	{% else %}
            	<div style="color: black; text-align: center;" class="alert alert-{{ message.tags }}" role="alert">{{message}}</div>
            	{% endif %}
            {% endfor %}
        {% endif %}
		<div class="s01">
			<form method="post">
				{% csrf_token %}
				<fieldset>
					<legend style="color: black;">Shall we find a tutor for you?</legend>
				</fieldset>
				<div class="inner-form">
					<div class="input-field first-wrap">
						<input type="text" name="generalQuery" placeholder="Try 'GCES Maths'" />
					</div>
					<div class="input-field third-wrap">
						<button class="btn-search" type="submit">Search</button>
					</div>
				</div>
			</form>
		</div>
	{% endif %}
</div>
<script type="text/javascript">

    var PRICE_FROM = {{defaultPriceValues.priceFrom}};
    var PRICE_TO = {{defaultPriceValues.priceTo}};

    var TUTOR_SCORE_FROM = {{defaultScoreValues.scoreFrom}};
    var TUTOR_SCORE_TO = {{defaultScoreValues.scoreTo}};


	function profilePictureNotFound()
	{
		$('.img-class-tutor-profile-picture').attr('src','{% static "img/default-user-icon.jpg" %}');
	}

	( function ($)
        {
            // Nice Select
            $('.nice-select').niceSelect();
        }
    )(jQuery)

    window.onload = function()
    {
        // parseTutorProfileComponent();
        renderTutorProfiles();
    };

    function parseTutorProfileComponent()
    {
        var components = [];

        {% for tutor in tutorList %}

            components.push(
                {
                    "profileImage": "{{ tutor.getTutoringUrl }}",
                    "profilePageUrl": "{{ tutor.getTutoringUrl }}",
                    "chargeRate": "{{tutor.chargeRate}}",
                    "summary": "{{tutor.summary}}",
                    "about": "{{tutor.about|linebreaks}}",
                }
            );

        {% endfor %}

        renderTutorProfiles(components);

    }

    function renderTutorProfiles()
    {
        // for (const element of theArray)
        // {

        // }

         // background-color: coral;
         // background-color: coral;
         // background-color: coral;
         // background-color: coral;
         // background-color: coral;
        {% for tutor in tutorList %}

        var score = 0;
        {% for tutorLesson in tutor.tutorLessons.all %}
            score += Number('{{ tutorLesson.points }}');
        {% endfor %}

        var featureBadges = "";

        {% for feature in tutor.features.all %}
         featureBadges += '<span class="badge badge-primary" style="background-color: {{feature.colour}};">{{feature.name|upper}}</span>&nbsp;&nbsp;'
        {% endfor %}

        var newComponent = `
        <div class="list-grid-item mt-4 p-2">
            <div class="row">
                <div class="col-md-9">
                    <div class="candidates-img float-left mr-4">
                        <img src="{{ tutor.profilePicture.url }}" alt="" class="img-fluid d-block rounded">
                    </div>
                    <div class="candidates-list-desc job-single-meta  pt-2">
                        <span class="mb-2 f-19">
                           <a href="{{ tutor.getTutoringUrl }}" class="text-dark" style="font-size: 23px;">{{tutor.user.get_full_name}}</a>
                           `+featureBadges+`
                        </span>
                        <ul class="list-inline mb-0">
                            <li class="list-inline-item">
                                <p class="text-muted f-15 mb-0"><i class="far fa-star"></i>  Earned `+score+` tutor score </p>
                            </li>

                            <li class="list-inline-item">
                                <p class="text-muted f-15 mb-0"><i class="fas fa-chalkboard-teacher"></i> {{tutor.tutorLessons.count}} lessons taught </p>
                            </li>

                            <li class="list-inline-item">
                                <p class="text-muted f-15 mb-0"><i class="mdi mdi-currency-gbp"></i>{{tutor.chargeRate}} / Hour</p>
                            </li>
                        </ul>
                        <p class="text-muted" style="display: -webkit-box; -webkit-line-clamp: 1; -webkit-box-orient: vertical; overflow: hidden;">Summary : {{tutor.summary}}</p>
                    </div>
                </div>

                <div class="col-md-3">
                    <div class="candidates-list-fav-btn text-right">
                        <div class="fav-icon">
                            <i class="mdi mdi-heart f-20"></i>
                        </div>
                        <div class="candidates-listing-btn mt-4">
                            <a href="{{ tutor.getTutoringUrl }}" class="btn btn-outline btn-sm">View Profile</a>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-lg-11 offset-lg-1">
                    <div class="candidates-item-desc">
                        <hr>
                        <p class="text-muted mb-2 f-14" style="display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden;">About : {{tutor.about}}</p>
                    </div>
                </div>
            </div>
        </div>`;

        $('#candidates-listing-item').append(newComponent);

        {% endfor %}
    }

    $(".js-range-slider-price").ionRangeSlider(
        {
            type: "double",
            min: 0,
            max: 100,
            from: {{defaultPriceValues.priceFrom}},
            to: {{defaultPriceValues.priceTo}},
            max_postfix: "+",
            prefix: "£",
            grid: true,

            onStart: function (data)
            {
                // Called right after range slider instance initialised
        
                // console.log(data.input);        // jQuery-link to input
                // console.log(data.slider);       // jQuery-link to range sliders container
                // console.log(data.min);          // MIN value
                // console.log(data.max);          // MAX values
                // console.log(data.from);         // FROM value
                // console.log(data.from_percent); // FROM value in percent
                // console.log(data.from_value);   // FROM index in values array (if used)
                // console.log(data.to);           // TO value
                // console.log(data.to_percent);   // TO value in percent
                // console.log(data.to_value);     // TO index in values array (if used)
                // console.log(data.min_pretty);   // MIN prettified (if used)
                // console.log(data.max_pretty);   // MAX prettified (if used)
                // console.log(data.from_pretty);  // FROM prettified (if used)
                // console.log(data.to_pretty);    // TO prettified (if used)
            },
    
            onChange: function (data)
            {
                // Called every time handle position is changed
                PRICE_FROM = data.from;
                PRICE_TO = data.to;
            },
    
            onFinish: function (data)
            {
                // Called then action is done and mouse is released                
            },
    
            onUpdate: function (data)
            {
                // Called then slider is changed using Update public method
            }
        }
    );

    $(".js-range-slider-score").ionRangeSlider(
        {
            type: "double",
            min: 0,
            max: 2000,
            from: {{defaultScoreValues.scoreFrom}},
            to: {{defaultScoreValues.scoreTo}},
            max_postfix: "+",
            prefix: "Score: ",
            grid: true,

            onStart: function (data)
            {
                // Called right after range slider instance initialised
            },
    
            onChange: function (data)
            {
                // Called every time handle position is changed
                TUTOR_SCORE_FROM = data.from;
                TUTOR_SCORE_TO = data.to;
            },
    
            onFinish: function (data)
            {
                // Called then action is done and mouse is released                
            },
    
            onUpdate: function (data)
            {
                // Called then slider is changed using Update public method
            }
        }
    );

   $('input:checkbox').change(
      function()
      {
         if ($(this).is(':checked'))
         {
            // for feature filters
            if (this.id.includes("features"))
            {
               let listOfCheckBoxes = ["features-all-type", "features-inPersonLessons", "features-onlineLessons", "features-pro"];

               if (this.id == listOfCheckBoxes[0])
               {
                  for (var i = 1; i < listOfCheckBoxes.length; i++)
                  {
                     $('#'+listOfCheckBoxes[i]).prop('checked', true);
                  }
               }
               else
               {
                  var allChecked = true;
                  for (var i = 1; i < listOfCheckBoxes.length; i++)
                  {
                     if(!$('#' + listOfCheckBoxes[i]).is(":checked"))
                        allChecked = false;
                  }

                  if (allChecked)
                     $('#'+listOfCheckBoxes[0]).prop('checked', true);
               }
            }
         }
         else
         {
            if (this.id.includes("features"))
            {
               let listOfCheckBoxes = ["features-all-type", "features-inPersonLessons", "features-onlineLessons", "features-pro"];

               if (this.id == listOfCheckBoxes[0])
               {
                  for (var i = 1; i < listOfCheckBoxes.length; i++)
                  {
                     $('#'+listOfCheckBoxes[i]).prop('checked', false);
                  }
               }
               else
               {
                  var allChecked = false;
                  for (var i = 1; i < listOfCheckBoxes.length; i++)
                  {
                     if(!$('#' + listOfCheckBoxes[i]).is(":checked"))
                        allChecked = true;
                  }

                  if (allChecked)
                     $('#'+listOfCheckBoxes[0]).prop('checked', false);
               }
            }
         }
      }
   );



    function searchBySubjectAndFilter()
    {
      let listOfCheckBoxes = ["features-inPersonLessons", "features-onlineLessons", "features-pro"];
      var requestedFilter = {};

      for (const checks of listOfCheckBoxes)
      {
         requestedFilter[checks] = $('#' + checks).is(":checked")
      }

      requestedFilter["priceFrom"] = PRICE_FROM;
      requestedFilter["priceTo"] = PRICE_TO;

      requestedFilter["scoreFrom"] = TUTOR_SCORE_FROM;
      requestedFilter["scoreTo"] = TUTOR_SCORE_TO;

       ["my-education-primary", "my-education-secondary", "my-education-gcse", "my-education-alevel", "my-education-undergraduate", "my-education-other"]

       var newFilters = "{{ generalQuery }}/" + JSON.stringify(requestedFilter);

      console.log(newFilters);
        window.location.href = "{% url 'tutoring:searchBySubjectAndFilter' searchParameters='data' %}".replace("data", newFilters);
    }

</script>
{% endblock %}