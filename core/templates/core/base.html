{% load static %}
{% load coreTemplateTags %}
<!DOCTYPE html>
<html lang='en-GB'>
    <head>
        <title>OneTutor</title>
        <meta http-equiv='X-UA-Compatible' content='IE=edge'/>
        <meta charset='utf-8'>
        <meta name='viewport' content='width=device-width, initial-scale=1, shrink-to-fit=no'>

        <link rel='stylesheet' href='https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css'
              integrity='sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N' crossorigin='anonymous'>
        <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css'
              integrity='sha512-MV7K8+y+gLIBoVD59lQIYicR65iaqukzvf/nwasF0nqhPay5w/9lJmVM2hMDcnK1OnMGCdVK+iQrJ7lzPJQd1w=='
              crossorigin='anonymous' referrerpolicy='no-referrer'/>
    </head>

    {% navigationPanel request as navigationPanel %}

    <body onload='handleCookieConsent();'>
        <nav class='navbar navbar-expand-lg navbar-dark bg-dark'>
            <a class='navbar-brand' href='#'>OneTutor</a>
            <div class='collapse navbar-collapse' id='navbarNavDropdown'>
                <ul class='navbar-nav ml-auto'>
                    {% for panel in navigationPanel %}
                        {% renderNavigationPanelComponent panel %}
                    {% endfor %}
                </ul>
            </div>
        </nav>

        <div class='container'>
            {% if messages %}
                <div class='w-100 p-3'></div>
                {% for msg in messages %}
                    <div style='color: black; text-align: center;'
                         class='alert alert-{% if msg.tags == 'error' %}danger{% else %}{{ msg.tags }}{% endif %}'
                         role='alert'>{{ msg|safe }}
                    </div>
                {% endfor %}
            {% endif %}
        </div>

        <div class='modal fade' id='cookieConsentModalCenter' data-backdrop='static' data-keyboard='false'>
            <div class='modal-dialog modal-dialog-centered'>
                <div class='modal-content'>
                    <div class='modal-header'>
                        <h5 class='modal-title'>Cookies</h5>
                    </div>
                    <div class='modal-body'>
                        We use cookies and similar technologies to enhance your browsing experience, analyze site
                        traffic, and personalize content. By clicking 'Accept' you consent to our use of cookies as
                        described in our Cookie Policy. For more information on how we use cookies and how you can
                        manage your preferences, please see our Cookie Policy.
                    </div>
                    <div class='modal-footer'>
                        <button type='button' class='btn btn-dark' onclick='acceptCookies();'>Accept</button>
                    </div>
                </div>
            </div>
        </div>

        <style>
            .invalid-feedback {
                text-align: center;
            }
        </style>

        {% block content %}
        {% endblock %}
    </body>

    <script src='https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js'
            integrity='sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj'
            crossorigin='anonymous'></script>
    <script src='https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js'
            integrity='sha384-Fy6S3B9q64WdZWQUiU+q4/2Lc9npb8tCaSX9FK7E8HnRr0Jz8D6OP9dO5Vg3Q9ct'
            crossorigin='anonymous'></script>
    <script>

        function acceptCookies() {
            fetch('{% url 'accounts:cookieConsentApiEventVersion1Component' %}', {
                method: 'PUT',
                headers: {
                    'Content-Encoding': 'gzip',
                    'Content-type': 'application/json',
                    'X-CSRFToken': getCookie('csrftoken')
                },
                dataType: 'json',
            }).then((response) => response.json())
                .then((response) => {
                    if (response.success) {
                        $('#cookieConsentModalCenter').modal('hide');
                    }
                })
        }

        function handleCookieConsent() {
            const isConsented = '{{ hasCookieAndSessionConsent }}' === 'True';
            if (!isConsented) {
                $('#cookieConsentModalCenter').modal('show');
            }
        }

        function getCookie(name) {
            let cookieValue = null;

            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');

                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();

                    // Does this cookie string begin with the name we want?
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

    </script>
</html>